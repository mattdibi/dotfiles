cmake_minimum_required(VERSION 3.6)
project( ${1:ProjectName} )

# Generate compilation database (needed for autocompletion)
set( CMAKE_EXPORT_COMPILE_COMMANDS ON )

# Options
option(CPPCHECK "Enable cppcheck static analysis" ON)
option(CLANG_TIDY "Enable clang_tidy static analysis" OFF)
option(IWYU "Enable include-what-you-use and link-what-you-use static analysis" OFF)

# Static analysis tools
message("")
# Cppcheck integration
find_program(CMAKE_CXX_CPPCHECK NAMES cppcheck)
if (CMAKE_CXX_CPPCHECK)
    message("-- Static analysis: cppcheck - found.")
    if(CPPCHECK)
        message("   cppcheck - ENABLED.")
        list(
            APPEND CMAKE_CXX_CPPCHECK
            "--enable=warning,performance"
            "--inconclusive"
            "--force"
            "--inline-suppr"
            )
    endif()
endif()

# Clang-tidy integration
find_program(CXX_CLANG_TIDY NAMES clang-tidy)
if (CXX_CLANG_TIDY)
    message("-- Static analysis: clang-tidy - found.")
    if(CLANG_TIDY)
        message("   clang-tidy - ENABLED.")
        set(CMAKE_CXX_CLANG_TIDY "clang-tidy;-checks=*,clang-analyzer-*,-clang-analyzer-cplusplus*")
    endif()
endif()

# include-what-you-use integration
find_program(CXX_INCLUDE_WHAT_YOU_USE NAMES include-what-you-use iwyu)
if(CXX_INCLUDE_WHAT_YOU_USE)
    message("-- Static analysis: include-what-you-use - found.")
    if(IWYU)
        message("   include-what-you-use - ENABLED.")
        set(CMAKE_CXX_INCLUDE_WHAT_YOU_USE "iwyu;-Xiwyu;any;-Xiwyu;iwyu;-Xiwyu;args")
        set(CMAKE_LINK_WHAT_YOU_USE)
    endif()
endif()

message("")

find_package( OpenCV REQUIRED )

set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Wall -pthread -fPIC -O2 -DPLAT_LINUX -std=gnu++0x")

include_directories( ${OpenCV_INCLUDE_DIRS} )
add_executable( $1 main.cpp )
target_link_libraries( ${OpenCV_LIBS} )
